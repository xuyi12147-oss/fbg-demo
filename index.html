<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>FBG 边缘滤波法 动画讲解</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "PingFang SC", "Microsoft Yahei", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%, #000 100%);
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .app {
      width: 100%;
      max-width: 1100px;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 18px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
      padding: 24px 26px 20px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      position: relative;
      overflow: hidden;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .title-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.03em;
    }

    .subtitle {
      font-size: 12px;
      color: #9ca3af;
    }

    .step-indicator {
      font-size: 12px;
      color: #9ca3af;
    }

    .step-indicator span {
      color: #f97316;
      font-weight: 600;
    }

    .main {
      display: grid;
      grid-template-columns: 1.4fr 1fr;
      gap: 16px;
      margin-top: 6px;
    }

    .left, .right {
      position: relative;
      min-height: 340px;
    }

    /* 卡片样式 */
    .card {
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.1), transparent 60%);
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 16px 18px;
      height: 100%;
      position: relative;
      overflow: hidden;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: #cbd5f5;
    }

    .card-body {
      font-size: 13px;
      color: #d1d5db;
      line-height: 1.5;
    }

    /* 动画相关 */
    .step {
      position: absolute;
      inset: 0;
      opacity: 0;
      transform: translateY(12px);
      pointer-events: none;
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    .step.active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .fade-in-up {
      opacity: 0;
      transform: translateY(8px);
      animation: fadeInUp 0.6s ease forwards;
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* 光谱绘图区域 */
    .spectrum-canvas {
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.95));
      border-radius: 14px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      margin-top: 6px;
      padding: 10px 14px 12px;
      position: relative;
      height: 260px;
      overflow: hidden;
    }

    .axis {
      position: absolute;
      left: 32px;
      bottom: 28px;
      right: 12px;
      height: 1px;
      background: linear-gradient(to right, #4b5563, #6b7280);
    }

    .axis::after {
      content: "波长 λ";
      position: absolute;
      right: 0;
      top: 4px;
      font-size: 11px;
      color: #9ca3af;
    }

    .peak {
      position: absolute;
      bottom: 28px;
      width: 70px;
      height: 110px;
      background: linear-gradient(to top, rgba(96, 165, 250, 0.1), rgba(96, 165, 250, 0.9));
      clip-path: polygon(50% 0, 100% 100%, 0 100%);
      box-shadow: 0 0 14px rgba(96, 165, 250, 0.8);
      transition: transform 0.7s ease;
    }

    .peak-label {
      position: absolute;
      font-size: 11px;
      color: #93c5fd;
      bottom: 142px;
      transform: translateX(-50%);
      white-space: nowrap;
    }

    .filter-slope {
      position: absolute;
      bottom: 28px;
      left: 44px;
      width: calc(100% - 72px);
      height: 120px;
      background: linear-gradient(to right, rgba(55, 65, 81, 0.2), rgba(52, 211, 153, 0.9));
      clip-path: polygon(0 100%, 55% 100%, 100% 0, 0 0);
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .filter-slope::after {
      content: "滤波器透射率 T(λ)";
      position: absolute;
      top: 6px;
      right: 12px;
      font-size: 11px;
      color: #bbf7d0;
    }

    .filter-slope.visible {
      opacity: 1;
    }

    .intensity-bar {
      position: absolute;
      width: 16px;
      bottom: 28px;
      right: 24px;
      height: 10px;
      border-radius: 999px 999px 2px 2px;
      background: linear-gradient(to top, rgba(248, 250, 252, 0.1), rgba(250, 204, 21, 0.9));
      box-shadow: 0 0 8px rgba(250, 204, 21, 0.8);
      transform-origin: bottom;
      transition: height 0.7s ease;
    }

    .intensity-label {
      position: absolute;
      right: 20px;
      bottom: 156px;
      font-size: 11px;
      color: #fde68a;
      writing-mode: vertical-rl;
      text-orientation: mixed;
    }

    .arrow {
      position: absolute;
      font-size: 11px;
      color: #f97316;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .arrow span {
      opacity: 0.9;
    }

    .small-note {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 6px;
    }

    /* 右侧公式、说明 */
    .right-card {
      background: radial-gradient(circle at bottom, rgba(79, 70, 229, 0.28), transparent 60%);
    }

    .eq {
      font-family: "JetBrains Mono", "Cascadia Code", Consolas, monospace;
      font-size: 12px;
      background: rgba(15, 23, 42, 0.85);
      padding: 6px 8px;
      border-radius: 8px;
      margin: 4px 0;
      border: 1px solid rgba(75, 85, 99, 0.9);
    }

    .list {
      margin-top: 8px;
      font-size: 13px;
      line-height: 1.6;
    }

    .list li {
      margin-left: 16px;
      margin-bottom: 4px;
    }

    /* 底部控制条 */
    .footer {
      margin-top: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #9ca3af;
    }

    .buttons {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    button {
      border: none;
      padding: 6px 12px;
      border-radius: 999px;
      background: linear-gradient(to right, #38bdf8, #6366f1);
      color: white;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 8px 24px rgba(37, 99, 235, 0.5);
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    }

    button.secondary {
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.6);
      box-shadow: none;
    }

    button:disabled {
      opacity: 0.35;
      cursor: not-allowed;
      box-shadow: none;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 10px 28px rgba(59, 130, 246, 0.6);
      filter: brightness(1.03);
    }

    .progress-dots {
      display: flex;
      gap: 4px;
      align-items: center;
    }

    .dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.3);
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .dot.active {
      background: #38bdf8;
      transform: scale(1.4);
    }

    .tagline {
      font-size: 11px;
      color: #6b7280;
    }

    @media (max-width: 900px) {
      .main {
        grid-template-columns: 1fr;
      }
      .left, .right {
        min-height: 260px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="title-group">
        <div class="title">FBG 边缘滤波法 · 动画讲解</div>
        <div class="subtitle">从“波长漂移”到“电压信号”的完整解调过程</div>
      </div>
      <div class="step-indicator">
        步骤 <span id="stepNumber">1</span> / <span id="stepTotal">5</span>
      </div>
    </div>

    <div class="main">
      <!-- 左侧：动态示意 -->
      <div class="left">
        <div class="card">
          <div class="card-title">
            动画示意
            <span class="badge">点击下方“下一步”观看流程</span>
          </div>
          <div class="spectrum-canvas">
            <!-- 坐标轴 -->
            <div class="axis"></div>

            <!-- FBG 峰 -->
            <div id="peak" class="peak" style="left: 40%;">
              <div id="peakLabel" class="peak-label">FBG 反射光谱</div>
            </div>

            <!-- 滤波器斜坡 -->
            <div id="filterSlope" class="filter-slope"></div>

            <!-- 光强柱 -->
            <div id="intensityLabel" class="intensity-label" style="display:none;">滤波后光强 I</div>
            <div id="intensityBar" class="intensity-bar" style="height: 18px; display:none;"></div>

            <!-- 箭头说明（动态修改文本） -->
            <div id="arrow1" class="arrow" style="bottom: 150px; left: 14px; opacity:0;">
              <span>温度/应变变化 → 波长漂移 Δλ</span>
            </div>
            <div id="arrow2" class="arrow" style="bottom: 96px; right: 118px; opacity:0;">
              <span>在斜坡上移动 → 透射率变化</span>
            </div>
            <div id="arrow3" class="arrow" style="bottom: 190px; right: 34px; opacity:0; flex-direction:column; text-align:right;">
              <span>光强变化 ΔI</span>
              <span>→ 电压变化 ΔV</span>
            </div>

            <div class="small-note" id="smallNote">
              第 1 步：FBG 只改变“反射波长”，光谱整体左右移动。
            </div>
          </div>
        </div>
      </div>

      <!-- 右侧：解释 + 公式 -->
      <div class="right">
        <!-- 步骤 1 -->
        <div class="step active" data-step="1">
          <div class="card right-card">
            <div class="card-title">
              Step 1 · FBG 反射光谱：只改变“位置”
            </div>
            <div class="card-body">
              <p>外界温度 / 应变改变光纤的有效折射率 <em>n<sub>eff</sub></em> 和光栅周期 Λ，使 FBG 的中心反射波长发生漂移：</p>
              <div class="eq">
                λ<sub>B</sub> = 2 · n<sub>eff</sub> · Λ
              </div>
              <p style="margin-top:4px;">
                传感量变化 → λ<sub>B</sub> 向左 / 向右平移，即出现波长漂移 Δλ。
              </p>
              <ul class="list">
                <li>此时<strong>光谱形状几乎不变</strong>，只是整体平移。</li>
                <li>FBG 完成了“把物理量编码到波长”的第一步。</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- 步骤 2 -->
        <div class="step" data-step="2">
          <div class="card right-card">
            <div class="card-title">
              Step 2 · 进入斜坡滤波器：波长 → 强度
            </div>
            <div class="card-body">
              <p>将 FBG 反射光谱送入一个具有陡峭边缘的滤波器（长通 / 短通），在斜率区工作：</p>
              <div class="eq">
                I = I<sub>0</sub> · T(λ<sub>B</sub>)
              </div>
              <p style="margin-top:4px;">在斜坡的线性区，T(λ) 可以近似为一条直线，因此：</p>
              <div class="eq">
                ΔI ≈ (dT / dλ) · I<sub>0</sub> · Δλ
              </div>
              <ul class="list">
                <li>FBG 波长轻微变化 → 滤波器透射率明显变化。</li>
                <li><strong>把难测的“波长漂移”变成易测的“光强变化”。</strong></li>
              </ul>
            </div>
          </div>
        </div>

        <!-- 步骤 3 -->
        <div class="step" data-step="3">
          <div class="card right-card">
            <div class="card-title">
              Step 3 · 光电探测：强度 → 电压
            </div>
            <div class="card-body">
              <p>滤波后的光强 I 被光电探测器转换为电信号：</p>
              <div class="eq">
                V = R · I
              </div>
              <p style="margin-top:4px;">其中 R 为探测器响应度，因此：</p>
              <div class="eq">
                ΔV = R · ΔI
              </div>
              <p style="margin-top:4px;">
                结合前一步的关系：<br />
                <strong>ΔV ∝ Δλ</strong> —— 电压变化直接携带了波长变化的信息。
              </p>
              <ul class="list">
                <li>光路部分到此结束，剩下是电子和算法。</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- 步骤 4 -->
        <div class="step" data-step="4">
          <div class="card right-card">
            <div class="card-title">
              Step 4 · 标定：电压 → 波长
            </div>
            <div class="card-body">
              <p>通过实验标定“电压变化”和“波长漂移”的线性关系：</p>
              <div class="eq">
                Δλ = K · ΔV
              </div>
              <p style="margin-top:4px;">
                这里 K 为标定得到的比例系数（拟合直线的斜率）。只要测得 ΔV，就能反推出 Δλ。
              </p>
              <ul class="list">
                <li>将模拟量 V 转换为光学量 λ。</li>
                <li>不同系统、不同滤波器对应不同的 K，需要单独标定。</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- 步骤 5 -->
        <div class="step" data-step="5">
          <div class="card right-card">
            <div class="card-title">
              Step 5 · 波长 → 温度 / 应变（最终解调）
            </div>
            <div class="card-body">
              <p>FBG 对应变和温度的灵敏度已知：</p>
              <div class="eq">
                Δλ = k<sub>ε</sub> · Δε + k<sub>T</sub> · ΔT
              </div>
              <p style="margin-top:4px;">
                如果只测一种量，例如仅测应变：
              </p>
              <div class="eq">
                Δε = Δλ / k<sub>ε</sub>
              </div>
              <p style="margin-top:4px;">
                或仅测温度：
              </p>
              <div class="eq">
                ΔT = Δλ / k<sub>T</sub>
              </div>
              <ul class="list">
                <li>至此：物理量 → 波长 → 强度 → 电压 → 波长 → 物理量，闭环完成。</li>
                <li>边缘滤波法用简单硬件实现了<strong>高速、低成本的 FBG 解调</strong>。</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 底部控制条 -->
    <div class="footer">
      <div class="tagline">
        小提示：反复切换步骤，观察左侧动画中“峰的位置”和“光强柱高度”的对应关系。
      </div>
      <div class="buttons">
        <div class="progress-dots" id="dots"></div>
        <button id="prevBtn" class="secondary" disabled>
          ◀ 上一步
        </button>
        <button id="nextBtn">
          下一步 ▶
        </button>
      </div>
    </div>
  </div>

  <script>
    const totalSteps = 5;
    let currentStep = 1;

    const stepNumberEl = document.getElementById('stepNumber');
    const stepTotalEl = document.getElementById('stepTotal');
    const steps = document.querySelectorAll('.step');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const dotsContainer = document.getElementById('dots');

    const peak = document.getElementById('peak');
    const peakLabel = document.getElementById('peakLabel');
    const filterSlope = document.getElementById('filterSlope');
    const intensityBar = document.getElementById('intensityBar');
    const intensityLabel = document.getElementById('intensityLabel');
    const arrow1 = document.getElementById('arrow1');
    const arrow2 = document.getElementById('arrow2');
    const arrow3 = document.getElementById('arrow3');
    const smallNote = document.getElementById('smallNote');

    stepTotalEl.textContent = totalSteps.toString();

    // 初始化进度点
    for (let i = 1; i <= totalSteps; i++) {
      const dot = document.createElement('div');
      dot.className = 'dot' + (i === 1 ? ' active' : '');
      dot.dataset.step = i.toString();
      dotsContainer.appendChild(dot);
    }

    function setArrowVisibility(el, visible) {
      el.style.transition = 'opacity 0.4s ease';
      el.style.opacity = visible ? '1' : '0';
    }

    function updateVisuals(step) {
      // 重置
      filterSlope.classList.remove('visible');

      // 默认光强条隐藏
      intensityBar.style.display = 'none';
      intensityLabel.style.display = 'none';

      // 箭头默认隐藏
      setArrowVisibility(arrow1, false);
      setArrowVisibility(arrow2, false);
      setArrowVisibility(arrow3, false);

      // 步骤说明
      if (step === 1) {
        // 峰在中间，滤波器还没出现
        peak.style.transform = 'translateX(0px)';
        peakLabel.textContent = 'FBG 反射光谱';
        smallNote.textContent = '第 1 步：FBG 只改变“反射波长”，光谱整体左右移动。';
        setArrowVisibility(arrow1, true);
      }

      if (step === 2) {
        // 显示滤波器，峰在斜坡区
        filterSlope.classList.add('visible');
        peak.style.transform = 'translateX(10px)';
        peakLabel.textContent = 'λB 位于滤波器斜坡区';
        smallNote.textContent = '第 2 步：在滤波器斜率区，小小的波长漂移会变成明显的透射率变化。';
        setArrowVisibility(arrow1, true);
        setArrowVisibility(arrow2, true);
      }

      if (step === 3) {
        filterSlope.classList.add('visible');
        // 模拟波长再漂移一点点 → 强度变化
        peak.style.transform = 'translateX(26px)';
        peakLabel.textContent = 'λB 轻微漂移 → 透射变化';
        intensityBar.style.display = 'block';
        intensityLabel.style.display = 'block';
        intensityBar.style.height = '52px';
        smallNote.textContent = '第 3 步：在斜坡上，λ 稍变 → 透过光强 I 明显变化。';
        setArrowVisibility(arrow2, true);
        setArrowVisibility(arrow3, true);
      }

      if (step === 4) {
        filterSlope.classList.add('visible');
        peak.style.transform = 'translateX(26px)';
        peakLabel.textContent = '从 ΔI 映射为 ΔV';
        intensityBar.style.display = 'block';
        intensityLabel.style.display = 'block';
        intensityBar.style.height = '52px';
        smallNote.textContent = '第 4 步：光强变化 ΔI 被光电探测器转换为电压变化 ΔV。';
        setArrowVisibility(arrow3, true);
      }

      if (step === 5) {
        filterSlope.classList.add('visible');
        peak.style.transform = 'translateX(26px)';
        peakLabel.textContent = '最终得到温度 / 应变';
        intensityBar.style.display = 'block';
        intensityLabel.style.display = 'block';
        intensityBar.style.height = '52px';
        smallNote.textContent = '第 5 步：利用灵敏度常数，把 Δλ 变回物理量（温度 / 应变）。';
        setArrowVisibility(arrow3, true);
      }
    }

    function updateStep(step) {
      currentStep = step;
      stepNumberEl.textContent = step.toString();

      steps.forEach(el => {
        el.classList.toggle('active', parseInt(el.dataset.step) === step);
      });

      document.querySelectorAll('.dot').forEach(dot => {
        dot.classList.toggle('active', parseInt(dot.dataset.step) === step);
      });

      prevBtn.disabled = step === 1;
      nextBtn.disabled = step === totalSteps;

      updateVisuals(step);
    }

    prevBtn.addEventListener('click', () => {
      if (currentStep > 1) {
        updateStep(currentStep - 1);
      }
    });

    nextBtn.addEventListener('click', () => {
      if (currentStep < totalSteps) {
        updateStep(currentStep + 1);
      }
    });

    // 点击圆点跳转
    dotsContainer.addEventListener('click', (e) => {
      const target = e.target;
      if (target.classList.contains('dot')) {
        const s = parseInt(target.dataset.step);
        updateStep(s);
      }
    });

    // 初始化画面
    updateVisuals(1);
  </script>
</body>
</html>

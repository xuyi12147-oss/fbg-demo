<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>光纤光栅边缘滤波解调模拟系统</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ed 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 25px 0;
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        
        h1 {
            font-size: 2.4rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 300;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .comparison-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 1200px) {
            .comparison-section {
                grid-template-columns: 1fr;
            }
        }
        
        .comparison-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        }
        
        .area-panel {
            grid-column: 1 / -1;
            margin-top: 30px;
        }
        
        .panel-title {
            font-size: 1.4rem;
            color: #1a237e;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .control-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
            justify-content: space-around;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 200px;
        }
        
        .control-title {
            font-size: 1.1rem;
            color: #1a237e;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .slider-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .slider-value {
            font-size: 1rem;
            font-weight: 600;
            color: #283593;
            margin-bottom: 8px;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            border-radius: 5px;
            outline: none;
        }
        
        .direct-slider {
            background: linear-gradient(to right, #d32f2f, #f44336);
        }
        
        .demod-slider {
            background: linear-gradient(to right, #388e3c, #4caf50);
        }
        
        .area-slider {
            background: linear-gradient(to right, #3949ab, #5c6bc0);
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .direct-slider::-webkit-slider-thumb {
            background: #d32f2f;
        }
        
        .demod-slider::-webkit-slider-thumb {
            background: #388e3c;
        }
        
        .area-slider::-webkit-slider-thumb {
            background: #3949ab;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 900px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }
        
        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            height: 350px;
            display: flex;
            flex-direction: column;
        }
        
        .chart-title {
            font-size: 1.2rem;
            color: #1a237e;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }
        
        .chart-container {
            flex-grow: 1;
            position: relative;
        }
        
        .data-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .data-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid;
        }
        
        .direct-data {
            border-left-color: #d32f2f;
        }
        
        .demod-data {
            border-left-color: #388e3c;
        }
        
        .area-data {
            border-left-color: #3949ab;
        }
        
        .data-title {
            font-size: 1rem;
            color: #555;
            margin-bottom: 8px;
        }
        
        .data-value {
            font-size: 1.4rem;
            font-weight: 600;
        }
        
        .direct-value {
            color: #d32f2f;
        }
        
        .demod-value {
            color: #388e3c;
        }
        
        .area-value {
            color: #3949ab;
        }
        
        .btn-reset {
            display: block;
            margin: 0 auto 25px;
            padding: 10px 25px;
            background: #3949ab;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-reset:hover {
            background: #283593;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #e0e0e0;
        }
        
        .sensitivity-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .low-sensitivity {
            background-color: #d32f2f;
        }
        
        .high-sensitivity {
            background-color: #388e3c;
        }
        
        .area-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 4px;
        }
        
        .legend-text {
            font-size: 0.9rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>光纤光栅边缘滤波解调模拟系统</h1>
            <p class="subtitle">交互式模拟光纤布拉格光栅(FBG)在温度与应变变化下的响应及边缘滤波解调过程</p>
        </header>
        
        <div class="comparison-section">
            <div class="comparison-panel">
                <div class="panel-title">直接检测（无解调器）</div>
                
                <div class="control-panel">
                    <div class="control-group">
                        <div class="control-title">温度控制 (°C)</div>
                        <div class="slider-container">
                            <div class="slider-value" id="directTempValue">20.0 °C</div>
                            <input type="range" id="directTempSlider" class="direct-slider" min="-50" max="150" value="20" step="0.1">
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <div class="control-title">应变控制 (με)</div>
                        <div class="slider-container">
                            <div class="slider-value" id="directStrainValue">0 με</div>
                            <input type="range" id="directStrainSlider" class="direct-slider" min="0" max="3000" value="0" step="10">
                        </div>
                    </div>
                    
                    <button class="btn-reset" id="directResetBtn">重置参数</button>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">FBG反射光谱</div>
                        <div class="chart-container">
                            <canvas id="directSpectrumChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-title">直接检测信号输出</div>
                        <div class="chart-container">
                            <canvas id="directOutputChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="data-panel">
                    <div class="data-card direct-data">
                        <div class="data-title">FBG中心波长</div>
                        <div class="data-value direct-value" id="directWavelengthValue">1550.00 nm</div>
                    </div>
                    
                    <div class="data-card direct-data">
                        <div class="data-title">直接检测光强</div>
                        <div class="data-value direct-value" id="directIntensityValue">1.00 mW</div>
                    </div>
                    
                    <div class="data-card direct-data">
                        <div class="data-title">检测灵敏度</div>
                        <div class="data-value direct-value"><span class="sensitivity-indicator low-sensitivity"></span>低</div>
                    </div>
                </div>
            </div>
            
            <div class="comparison-panel">
                <div class="panel-title">边缘滤波解调（有解调器）</div>
                
                <div class="control-panel">
                    <div class="control-group">
                        <div class="control-title">温度控制 (°C)</div>
                        <div class="slider-container">
                            <div class="slider-value" id="demodTempValue">20.0 °C</div>
                            <input type="range" id="demodTempSlider" class="demod-slider" min="-50" max="150" value="20" step="0.1">
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <div class="control-title">应变控制 (με)</div>
                        <div class="slider-container">
                            <div class="slider-value" id="demodStrainValue">0 με</div>
                            <input type="range" id="demodStrainSlider" class="demod-slider" min="0" max="3000" value="0" step="10">
                        </div>
                    </div>
                    
                    <button class="btn-reset" id="demodResetBtn">重置参数</button>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">FBG反射谱与边缘滤波器透射谱</div>
                        <div class="chart-container">
                            <canvas id="demodSpectrumChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-title">边缘滤波解调信号输出</div>
                        <div class="chart-container">
                            <canvas id="demodOutputChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="data-panel">
                    <div class="data-card demod-data">
                        <div class="data-title">FBG中心波长</div>
                        <div class="data-value demod-value" id="demodWavelengthValue">1550.00 nm</div>
                    </div>
                    
                    <div class="data-card demod-data">
                        <div class="data-title">滤波后输出光强</div>
                        <div class="data-value demod-value" id="demodIntensityValue">0.50 mW</div>
                    </div>
                    
                    <div class="data-card demod-data">
                        <div class="data-title">解调灵敏度</div>
                        <div class="data-value demod-value"><span class="sensitivity-indicator high-sensitivity"></span>高</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="comparison-panel area-panel">
            <div class="panel-title">光强面积对比分析（直接检测 vs 边缘滤波解调）</div>
            
            <div class="control-panel">
                <div class="control-group">
                    <div class="control-title">温度变化范围 (°C)</div>
                    <div class="slider-container">
                        <div class="slider-value" id="tempRangeValue">-50 到 150 °C</div>
                        <input type="range" id="tempRangeSlider" class="area-slider" min="20" max="300" value="200" step="10">
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="control-title">应变变化范围 (με)</div>
                    <div class="slider-container">
                        <div class="slider-value" id="strainRangeValue">0 到 3000 με</div>
                        <input type="range" id="strainRangeSlider" class="area-slider" min="500" max="5000" value="3000" step="100">
                    </div>
                </div>
                
                <button class="btn-reset" id="areaResetBtn">重置对比分析</button>
            </div>
            
            <div class="charts-container">
                <div class="chart-card">
                    <div class="chart-title">温度变化下的光强响应对比</div>
                    <div class="chart-container">
                        <canvas id="tempResponseChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">应变变化下的光强响应对比</div>
                    <div class="chart-container">
                        <canvas id="strainResponseChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="data-panel">
                <div class="data-card direct-data">
                    <div class="data-title">直接检测灵敏度</div>
                    <div class="data-value direct-value" id="directSensitivityValue">0.002 mW/°C</div>
                </div>
                
                <div class="data-card demod-data">
                    <div class="data-title">边缘滤波解调灵敏度</div>
                    <div class="data-value demod-value" id="demodSensitivityValue">0.15 mW/°C</div>
                </div>
                
                <div class="data-card area-data">
                    <div class="data-title">灵敏度提升倍数</div>
                    <div class="data-value area-value" id="sensitivityImprovementValue">75倍</div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>光纤光栅边缘滤波解调模拟系统 &copy; 2025 | 基于光纤传感原理与边缘滤波解调技术</p>
            <p>本模拟器基于光纤布拉格光栅传感原理和边缘滤波解调方法开发，用于教学和演示目的。</p>
        </footer>
    </div>

    <script>
        // 直接检测系统参数
        let directTemp = 20.0;   // 直接检测系统温度 (°C)
        let directStrain = 0;   // 直接检测系统应变 (με)
        
        // 边缘滤波解调系统参数
        let demodTemp = 20.0;   // 边缘滤波解调系统温度 (°C)
        let demodStrain = 0;    // 边缘滤波解调系统应变 (με)
        
        // 对比分析参数
        let tempRange = 200;    // 温度变化范围
        let strainRange = 3000;  // 应变变化范围
        
        // 时间计数器
        let timeCounter = 0;
        
        // 光纤光栅参数
        const baseWavelength = 1550.0;  // 基础中心波长 (nm)
        const tempSensitivity = 0.01;    // 温度灵敏度 (nm/°C)
        const strainSensitivity = 0.0012; // 应变灵敏度 (nm/με)
        const fbgBandwidth = 0.2;        // FBG带宽 (nm)
        
        // 边缘滤波器参数
        const filterCenter = 1550.5;     // 滤波器中心波长 (nm)
        const filterRange = 3.0;         // 滤波器线性范围 (nm)
        
        // 获取直接检测系统DOM元素
        const directTempSlider = document.getElementById('directTempSlider');
        const directStrainSlider = document.getElementById('directStrainSlider');
        const directTempValue = document.getElementById('directTempValue');
        const directStrainValue = document.getElementById('directStrainValue');
        const directResetBtn = document.getElementById('directResetBtn');
        
        // 直接检测相关显示元素
        const directWavelengthValue = document.getElementById('directWavelengthValue');
        const directIntensityValue = document.getElementById('directIntensityValue');
        
        // 获取边缘滤波解调系统DOM元素
        const demodTempSlider = document.getElementById('demodTempSlider');
        const demodStrainSlider = document.getElementById('demodStrainSlider');
        const demodTempValue = document.getElementById('demodTempValue');
        const demodStrainValue = document.getElementById('demodStrainValue');
        const demodResetBtn = document.getElementById('demodResetBtn');
        
        // 边缘滤波解调相关显示元素
        const demodWavelengthValue = document.getElementById('demodWavelengthValue');
        const demodIntensityValue = document.getElementById('demodIntensityValue');
        
        // 对比分析DOM元素
        const tempRangeSlider = document.getElementById('tempRangeSlider');
        const strainRangeSlider = document.getElementById('strainRangeSlider');
        const tempRangeValue = document.getElementById('tempRangeValue');
        const strainRangeValue = document.getElementById('strainRangeValue');
        const areaResetBtn = document.getElementById('areaResetBtn');
        
        // 对比分析显示元素
        const directSensitivityValue = document.getElementById('directSensitivityValue');
        const demodSensitivityValue = document.getElementById('demodSensitivityValue');
        const sensitivityImprovementValue = document.getElementById('sensitivityImprovementValue');
        
        // 初始化直接检测图表
        const directSpectrumCtx = document.getElementById('directSpectrumChart').getContext('2d');
        const directOutputCtx = document.getElementById('directOutputChart').getContext('2d');
        
        // 初始化边缘滤波解调图表
        const demodSpectrumCtx = document.getElementById('demodSpectrumChart').getContext('2d');
        const demodOutputCtx = document.getElementById('demodOutputChart').getContext('2d');
        
        // 初始化对比分析图表
        const tempResponseCtx = document.getElementById('tempResponseChart').getContext('2d');
        const strainResponseCtx = document.getElementById('strainResponseChart').getContext('2d');
        
        // 直接检测 - FBG反射光谱图表
        const directSpectrumChart = new Chart(directSpectrumCtx, {
            type: 'line',
            data: {
                labels: generateWavelengths(1545, 1555, 0.1),
                datasets: [{
                    label: 'FBG反射谱',
                    data: [],
                    borderColor: '#d32f2f',
                    backgroundColor: 'rgba(211, 47, 47, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: '波长 (nm)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: '反射率',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        min: 0,
                        max: 1,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                }
            }
        });
        
        // 直接检测 - 输出信号图表
        const directOutputChart = new Chart(directOutputCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: '直接检测信号',
                    data: [],
                    borderColor: '#d32f2f',
                    backgroundColor: 'rgba(211, 47, 47, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: '时间 (s)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: '输出光强 (mW)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        min: 0.9,
                        max: 1.1,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 12
                            }
                        }
                    }
                }
            }
        });
        
        // 边缘滤波解调 - 光谱图表
        const demodSpectrumChart = new Chart(demodSpectrumCtx, {
            type: 'line',
            data: {
                labels: generateWavelengths(1545, 1555, 0.1),
                datasets: [
                    {
                        label: 'FBG反射谱',
                        data: [],
                        borderColor: '#388e3c',
                        backgroundColor: 'rgba(56, 142, 60, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: '边缘滤波器透射谱',
                        data: [],
                        borderColor: '#3949ab',
                        backgroundColor: 'rgba(57, 73, 171, 0.1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: true,
                        tension: 0.2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: '波长 (nm)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: '强度 (a.u.)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        min: 0,
                        max: 1,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                }
            }
        });
        
        // 边缘滤波解调 - 输出信号图表
        const demodOutputChart = new Chart(demodOutputCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: '边缘滤波解调信号',
                    data: [],
                    borderColor: '#388e3c',
                    backgroundColor: 'rgba(56, 142, 60, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: '时间 (s)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: '输出电压 (V)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        min: 0,
                        max: 5,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 12
                            }
                        }
                    }
                }
            }
        });
        
        // 温度响应对比图表
        const tempResponseChart = new Chart(tempResponseCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: '直接检测光强',
                        data: [],
                        borderColor: '#d32f2f',
                        backgroundColor: 'rgba(211, 47, 47, 0.3)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: '边缘滤波解调光强',
                        data: [],
                        borderColor: '#388e3c',
                        backgroundColor: 'rgba(56, 142, 60, 0.3)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: '温度 (°C)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: '输出光强 (a.u.)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 12
                            }
                        }
                    }
                }
            }
        });
        
        // 应变响应对比图表
        const strainResponseChart = new Chart(strainResponseCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: '直接检测光强',
                        data: [],
                        borderColor: '#d32f2f',
                        backgroundColor: 'rgba(211, 47, 47, 0.3)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: '边缘滤波解调光强',
                        data: [],
                        borderColor: '#388e3c',
                        backgroundColor: 'rgba(56, 142, 60, 0.3)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: '应变 (με)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: '输出光强 (a.u.)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 12
                            }
                        }
                    }
                }
            }
        });
        
        // 生成波长数组
        function generateWavelengths(start, end, step) {
            const wavelengths = [];
            for (let w = start; w <= end; w += step) {
                wavelengths.push(w.toFixed(1));
            }
            return wavelengths;
        }
        
        // 计算FBG反射谱 (高斯分布)
        function calculateFBGSpectrum(centerWavelength) {
            const wavelengths = generateWavelengths(1545, 1555, 0.1);
            return wavelengths.map(w => {
                const x = (w - centerWavelength) / fbgBandwidth;
                return Math.exp(-x*x);
            });
        }
        
        // 计算边缘滤波器透射谱
        function calculateFilterSpectrum() {
            const wavelengths = generateWavelengths(1545, 1555, 0.1);
            return wavelengths.map(w => {
                // 线性区域
                if (Math.abs(w - filterCenter) < filterRange/2) {
                    return 0.5 + (w - filterCenter) * 0.15;
                }
                // 非线性区域
                else if (w < filterCenter) {
                    return 0.1;
                } else {
                    return 0.9;
                }
            });
        }
        
        // 计算直接检测光强
        function calculateDirectIntensity() {
            const baseIntensity = 1.0;
            const noise = (Math.random() - 0.5) * 0.02;
            return baseIntensity + noise;
        }
        
        // 计算通过滤波器后的光强
        function calculateDemodIntensity(centerWavelength) {
            const filterPosition = (centerWavelength - (filterCenter - filterRange/2)) / filterRange;
            let intensity = Math.max(0.1, Math.min(0.9, filterPosition));
            const noise = (Math.random() - 0.5) * 0.02;
            intensity += noise;
            return intensity;
        }
        
        // 生成温度变化数据
        function generateTempResponseData() {
            const temperatures = [];
            const directIntensities = [];
            const demodIntensities = [];
            
            const baseTemp = 20;
            const steps = 50;
            const minTemp = baseTemp - tempRange/2;
            const maxTemp = baseTemp + tempRange/2;
            
            for (let i = 0; i <= steps; i++) {
                const temp = minTemp + (tempRange * i / steps);
                temperatures.push(temp.toFixed(1));
                
                const wavelength = baseWavelength + temp * tempSensitivity;
                const directIntensity = 1.0 + (Math.random() - 0.5) * 0.02;
                const demodIntensity = calculateDemodIntensity(wavelength);
                
                directIntensities.push(directIntensity);
                demodIntensities.push(demodIntensity);
            }
            
            return { temperatures, directIntensities, demodIntensities };
        }
        
        // 生成应变变化数据
        function generateStrainResponseData() {
            const strains = [];
            const directIntensities = [];
            const demodIntensities = [];
            
            const steps = 50;
            
            for (let i = 0; i <= steps; i++) {
                const strain = strainRange * i / steps;
                strains.push(strain);
                
                const wavelength = baseWavelength + strain * strainSensitivity;
                const directIntensity = 1.0 + (Math.random() - 0.5) * 0.02;
                const demodIntensity = calculateDemodIntensity(wavelength);
                
                directIntensities.push(directIntensity);
                demodIntensities.push(demodIntensity);
            }
            
            return { strains, directIntensities, demodIntensities };
        }
        
        // 计算和显示灵敏度数据
        function calculateAndDisplaySensitivity(tempData, strainData) {
            if (tempData.directIntensities.length < 2) return;
            
            const directTempSensitivity = (tempData.directIntensities[tempData.directIntensities.length-1] - 
                                        tempData.directIntensities[0]) / tempRange;
            const demodTempSensitivity = (tempData.demodIntensities[tempData.demodIntensities.length-1] - 
                                        tempData.demodIntensities[0]) / tempRange;
            
            const tempImprovement = Math.abs(demodTempSensitivity / directTempSensitivity).toFixed(0);
            
            directSensitivityValue.textContent = Math.abs(directTempSensitivity).toFixed(4) + ' mW/°C';
            demodSensitivityValue.textContent = Math.abs(demodTempSensitivity).toFixed(3) + ' mW/°C';
            sensitivityImprovementValue.textContent = tempImprovement + '倍';
        }
        
        // 更新对比分析图表
        function updateComparisonCharts() {
            const tempData = generateTempResponseData();
            const strainData = generateStrainResponseData();
            
            tempResponseChart.data.labels = tempData.temperatures;
            tempResponseChart.data.datasets[0].data = tempData.directIntensities;
            tempResponseChart.data.datasets[1].data = tempData.demodIntensities;
            tempResponseChart.update();
            
            strainResponseChart.data.labels = strainData.strains;
            strainResponseChart.data.datasets[0].data = strainData.directIntensities;
            strainResponseChart.data.datasets[1].data = strainData.demodIntensities;
            strainResponseChart.update();
            
            calculateAndDisplaySensitivity(tempData, strainData);
        }
        
        // 更新直接检测系统
        function updateDirectSystem() {
            timeCounter += 0.5;
            
            const directWavelength = baseWavelength + 
                                     directTemp * tempSensitivity + 
                                     directStrain * strainSensitivity;
            
            const directFBGSpectrum = calculateFBGSpectrum(directWavelength);
            const directIntensity = calculateDirectIntensity();
            
            directSpectrumChart.data.datasets[0].data = directFBGSpectrum;
            directSpectrumChart.update();
            
            if (directOutputChart.data.labels.length > 20) {
                directOutputChart.data.labels.shift();
                directOutputChart.data.datasets[0].data.shift();
            }
            
            directOutputChart.data.labels.push(timeCounter.toFixed(1));
            directOutputChart.data.datasets[0].data.push(directIntensity);
            directOutputChart.update();
            
            directWavelengthValue.textContent = directWavelength.toFixed(2) + ' nm';
            directIntensityValue.textContent = directIntensity.toFixed(3) + ' mW';
            
            directTempValue.textContent = directTemp.toFixed(1) + ' °C';
            directStrainValue.textContent = directStrain + ' με';
        }
        
        // 更新边缘滤波解调系统
        function updateDemodSystem() {
            timeCounter += 0.5;
            
            const demodWavelength = baseWavelength + 
                                    demodTemp * tempSensitivity + 
                                    demodStrain * strainSensitivity;
            
            const demodFBGSpectrum = calculateFBGSpectrum(demodWavelength);
            const filterSpectrum = calculateFilterSpectrum();
            const demodIntensity = calculateDemodIntensity(demodWavelength);
            
            demodSpectrumChart.data.datasets[0].data = demodFBGSpectrum;
            demodSpectrumChart.data.datasets[1].data = filterSpectrum;
            demodSpectrumChart.update();
            
            if (demodOutputChart.data.labels.length > 20) {
                demodOutputChart.data.labels.shift();
                demodOutputChart.data.datasets[0].data.shift();
            }
            
            demodOutputChart.data.labels.push(timeCounter.toFixed(1));
            demodOutputChart.data.datasets[0].data.push(demodIntensity * 5);
            demodOutputChart.update();
            
            demodWavelengthValue.textContent = demodWavelength.toFixed(2) + ' nm';
            demodIntensityValue.textContent = (demodIntensity * 1000).toFixed(2) + ' μW';
            
            demodTempValue.textContent = demodTemp.toFixed(1) + ' °C';
            demodStrainValue.textContent = demodStrain + ' με';
        }
        
        // 直接检测系统事件监听
        directTempSlider.addEventListener('input', function() {
            directTemp = parseFloat(this.value);
            updateDirectSystem();
        });
        
        directStrainSlider.addEventListener('input', function() {
            directStrain = parseInt(this.value);
            updateDirectSystem();
        });
        
        directResetBtn.addEventListener('click', function() {
            directTemp = 20.0;
            directStrain = 0;
            
            directTempSlider.value = directTemp;
            directStrainSlider.value = directStrain;
            
            directOutputChart.data.labels = [];
            directOutputChart.data.datasets[0].data = [];
            directOutputChart.update();
            
            updateDirectSystem();
        });
        
        // 边缘滤波解调系统事件监听
        demodTempSlider.addEventListener('input', function() {
            demodTemp = parseFloat(this.value);
            updateDemodSystem();
        });
        
        demodStrainSlider.addEventListener('input', function() {
            demodStrain = parseInt(this.value);
            updateDemodSystem();
        });
        
        demodResetBtn.addEventListener('click', function() {
            demodTemp = 20.0;
            demodStrain = 0;
            
            demodTempSlider.value = demodTemp;
            demodStrainSlider.value = demodStrain;
            
            demodOutputChart.data.labels = [];
            demodOutputChart.data.datasets[0].data = [];
            demodOutputChart.update();
            
            updateDemodSystem();
        });
        
        // 对比分析事件监听
        tempRangeSlider.addEventListener('input', function() {
            tempRange = parseInt(this.value);
            const minTemp = 20 - tempRange/2;
            const maxTemp = 20 + tempRange/2;
            tempRangeValue.textContent = `${minTemp} 到 ${maxTemp} °C`;
            updateComparisonCharts();
        });
        
        strainRangeSlider.addEventListener('input', function() {
            strainRange = parseInt(this.value);
            strainRangeValue.textContent = `0 到 ${strainRange} με`;
            updateComparisonCharts();
        });
        
        areaResetBtn.addEventListener('click', function() {
            tempRange = 200;
            strainRange = 3000;
            
            tempRangeSlider.value = tempRange;
            strainRangeSlider.value = strainRange;
            
            tempRangeValue.textContent = `-50 到 150 °C`;
            strainRangeValue.textContent = `0 到 ${strainRange} με`;
            
            updateComparisonCharts();
        });
        
        // 初始更新
        updateDirectSystem();
        updateDemodSystem();
        updateComparisonCharts();
        
        // 定时更新
        setInterval(() => {
            updateDirectSystem();
            updateDemodSystem();
        }, 500);
    </script>
</body>
</html>
